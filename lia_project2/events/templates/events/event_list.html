{% extends "base.html" %}

{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'events/eventlist.css' %}">
{% endblock %}

{% block content %}
{% get_media_prefix as MEDIA_URL %}
    
<!-- Display banner according to selected category -->
{% if selected_category %}
    <div class="category-banner" 
        style="width: 100%; height: 250px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.5);">
        
        <img src="{{ MEDIA_URL }}events/category_{{ selected_category|lower }}.jpg" 
             alt="{{ selected_category }} Banner" 
             style="width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: -1;">
        
        <h2 style="position: relative; z-index: 2; color: white; font-size: 2rem; font-weight: bold; background: rgba(0, 0, 0, 0.5); padding: 10px 20px; border-radius: 5px;">
            {{ selected_category }}
        </h2>
    </div>
{% endif %}

<!-- Date and Category's Sort and Filter Tab -->
<section class="filter-container">
    <form method="GET" action="{% url 'event_list' %}">
        <select name="date" id="date-filter" onchange="this.form.submit()">
            <option value="any" {% if selected_date == "any" %}selected{% endif %}>Any Day</option>
            <option value="this_week" {% if selected_date == "this_week" %}selected{% endif %}>This Week</option>
            <option value="next_week" {% if selected_date == "next_week" %}selected{% endif %}>Next Week</option>
        </select>
        <select name="category" id="category-filter" onchange="this.form.submit()">
            <option value="" {% if not selected_category %}selected{% endif %}>All</option>
            {% for category in categories %}
                <option value="{{ category.name }}" {% if category.name == selected_category %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>
    </form>
</section>

<section class="subtitle">
    <h2 class="all">All</h2>
</section>

<section class="event-cards">
    {% if all_events.exists %}
    {% for event in all_events %}
        <div class="event-card">
            {% if event.image %}
                <a href="{% url 'event_detail' event.id %}">
                    <img src="{{ event.image.url }}" alt="Event Image" class="event-image">
                </a>
            {% else %}
                <p>No image available for this event.</p>
            {% endif %}
            <div class="event-card-content">
                <h3>{{ event.title }}</h3>
                <p><span class="fa-solid fa-calendar-days"></span> {{ event.start_datetime|date:"D, M j, g:i A" }}</p>
                <p>Location: {{ event.location }}</p>
                <form action="{% url 'toggle_like' event.id %}" method="POST"> 
                    {% csrf_token %}
                    <button type="submit" class="like-btn">
                        {% if user.is_authenticated and event.id in user_liked_events %}
                            <span class="favorite fas fa-heart"></span>
                        {% else %}
                            <span class="favorite fa-regular fa-heart"></span>
                        {% endif %}
                        <span class="like-count">{{ event.total_likes }}</span>
                    </button>
                </form>  

            </div>
        </div>
    {% endfor %}
{% else %}
    {% if query %}
        <p>No events found matching your search.</p>
    {% else %}
        <p>No events available at the moment.</p>
    {% endif %}
{% endif %}
</section>

<section class="categories">
    {% for category in categories %}
        <a href="{% url 'event_list' %}?category={{ category.name }}">
            <div>
                {% if category.name == "Music" %}
                    <span class="fas fa-music"></span>
                {% elif category.name == "Game" %}
                    <span class="fas fa-gamepad"></span>
                {% elif category.name == "Sports" %}
                    <span class="fas fa-basketball-ball"></span>
                {% elif category.name == "Developer" %}
                    <span class="fas fa-code"></span>
                {% elif category.name == "Conference" %}
                    <span class="fas fa-users"></span>
                {% elif category.name == "Travel" %}
                    <span class="fas fa-plane"></span>
                {% else %}
                    <span class="fas fa-folder"></span>
                {% endif %}
                <br>{{ category.name }}
            </div>
        </a>
    {% endfor %}
</section>


{% endblock %}